<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="\rAbstract The popular practice of having only two different kinds of builds (Debug and Release) is shown to be inadequate. Three to four different kinds of builds are proposed instead, allowing more thorough error checking during development, better performance of the final system on production, and potentially better performance when running tests on a build server.\n"><title>Build configurations</title><link rel=canonical href=https://blog2.michael.gr/post/2025-06-build-configurations/><link rel=stylesheet href=/scss/style.min.b390e410854a1900b4186a664a0397a2b4ee1b587bc335c2e9befc929a849158.css><meta property='og:title' content="Build configurations"><meta property='og:description' content="\rAbstract The popular practice of having only two different kinds of builds (Debug and Release) is shown to be inadequate. Three to four different kinds of builds are proposed instead, allowing more thorough error checking during development, better performance of the final system on production, and potentially better performance when running tests on a build server.\n"><meta property='og:url' content='https://blog2.michael.gr/post/2025-06-build-configurations/'><meta property='og:site_name' content="Michael's Blog"><meta property='og:type' content='article'><meta property='article:section' content='post'><meta property='article:tag' content='software-engineering'><meta property='article:tag' content='dotnet'><meta property='article:tag' content='csharp'><meta property='article:tag' content='msbuild'><meta property='article:tag' content='papers'><meta property='article:published_time' content='2025-05-04T13:39:03+00:00'><meta property='article:modified_time' content='2025-10-21T19:00:42+02:00'><meta name=twitter:title content="Build configurations"><meta name=twitter:description content="\rAbstract The popular practice of having only two different kinds of builds (Debug and Release) is shown to be inadequate. Three to four different kinds of builds are proposed instead, allowing more thorough error checking during development, better performance of the final system on production, and potentially better performance when running tests on a build server.\n"><link rel="shortcut icon" href=/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=TODO"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","TODO")}</script></head><body class="article-page
article-page"><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><ol class=menu id=main-menu><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol><a href=/><img src=/logo.svg width=210 loading=lazy alt=Logo></a><figure class=site-avatar><a href=/><img src="https://gravatar.com/avatar/8d1c5b5578843f958430afe30e0cbb2fb5092b1712d1933ea37d7bf5cb4305ed?size=400" width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure></header><ul class=menu-social><li><a href=/contact-via-e-mail/ title=e-Mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=/contact-via-whatsapp/ title=WhatsApp rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21l1.65-3.8a9 9 0 113.4 2.9L3 21"/><path d="M9 10a.5.5.0 001 0V9A.5.5.0 009 9v1a5 5 0 005 5h1a.5.5.0 000-1h-1a.5.5.0 000 1"/></svg></a></li><li><a href=https://github.com/mikenakis target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/mikenakis target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://stackoverflow.com/users/773113/mike-nakis target=_blank title="Stack Overflow" rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 17v1a2 2 0 002 2h12a2 2 0 002-2v-1"/><path d="M8 16h8"/><path d="M8.322 12.582l7.956.836"/><path d="M8.787 9.168l7.826 1.664"/><path d="M10.096 5.764l7.608 2.472"/></svg></a></li><li><a href=https://twitter.com/mikenakis target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ul><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#abstract>Abstract</a></li><li><a href=#the-issue>The Issue</a></li><li><a href=#the-history>The History</a></li><li><a href=#the-problem>The Problem</a></li><li><a href=#the-solution>The Solution</a></li><li><a href=#conclusions>Conclusions</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/post/2025-06-build-configurations/>Build configurations</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-05-04 Sun 13:39:03 UTC</time></div><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 20v-2a6 6 0 1112 0v2a1 1 0 01-1 1H7a1 1 0 01-1-1z"/><path d="M6 4v2a6 6 0 1012 0V4a1 1 0 00-1-1H7A1 1 0 006 4z"/></svg>
<time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><p><img src=/post/2025-06-build-configurations/images/ChatGPT-Image-Jun-11,-2025,-12_31_08-PM---fixed.jpg width=1536 height=1024 loading=lazy class=gallery-image data-flex-grow=150 data-flex-basis=360px></p><h3 id=abstract>Abstract</h3><p>The popular practice of having only two different kinds of builds (<em>Debug</em> and <em>Release</em>) is shown to be inadequate. Three to four different kinds of builds are proposed instead, allowing more thorough error checking during development, better performance of the final system on production, and potentially better performance when running tests on a build server.</p><p>(Useful pre-reading: <a href=/post/2022-11-about-these-papers/>About these papers</a>)</p><h3 id=the-issue>The Issue</h3><p>In software development we often want our creations to have different characteristics under different circumstances; for example:</p><ul><li>Optimizations:<ul><li>While developing we usually do not want them, because they interfere with debugging.</li><li>On the final shipped product we want them, because they make it run faster.</li></ul></li><li>Preconditions, assertions, and other kinds of runtime checks:<ul><li>While developing we want them, because they help us catch bugs.</li><li>On the final shipped product we do not want them, because they slow it down.</li></ul></li></ul><h3 id=the-history>The History</h3><p>In C and C++, different behavior has historically been achieved by means of compiler options controlling optimization, and preprocessor macros controlling conditional compilation. The standard stipulates an NDEBUG macro which, if defined, causes assertions to compile to nothing. This means that software systems written in C and C++ generally have two builds: a <em>Debug</em> build, for use while debugging, and a <em>Release</em> build, for shipping or deploying to production.</p><p>When Java came along, it was decided that a single build should be good for everyone: conditional compilation was abolished<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, all optimization-related choices were delegated to the Just-In-Time compiler (JITter,) assertions were made to always compile into the binaries, and the <code>enableassertions</code> switch was added to the virtual machine for controlling during runtime, rather than during compilation, whether assertions should be executing or not. This essentially gives Java developers the ability to choose between a <em>debug <strong>run</strong></em> or a <em>release <strong>run</strong></em>, as opposed to a debug build or a release build.</p><p>C# has brought back a compiler option for controlling optimization, and conditional compilation by means of a simplified version of the preprocessor macros (called "define constants" in C#) and the <code>Conditional</code> attribute. Two different kinds of builds (called <em><strong>Build Configurations</strong></em>) are predefined: <code>Debug</code> and <code>Release</code>. The build system offers great flexibility in defining additional build configurations, but C# developers rarely bother with that.</p><h3 id=the-problem>The Problem</h3><p>Since developers rarely bother with defining any build configurations besides the predefined ones, the vast majority of dotnet projects use only the two predefined ones: 'Debug' and 'Release'. (Many projects actually use only 'Debug', but let us pretend we never heard of them.) Thus all different needs and usage scenarios are being shoe-horned to fit into one of those two options. For example:</p><ul><li>There is only one configuration that can be tested, namely the <code>Debug</code> configuration, which means that this configuration is used not only for running tests on a developer's computer, but also for running tests on the build server.</li><li>There is only one configuration of a library that can be published, namely the 'Release' configuration, which means that this configuration is used not only in production scenarios, but also in development scenarios, where software is being developed that is making use of a published library.</li></ul><p>This is problematic because:</p><ul><li><p>It slows down test runs on build servers.</p><p>The 'Debug' configuration is unoptimized, to avoid interference with debugging; however, by common practice, the same 'Debug' configuration is used for running tests on the build server, because that is the only configuration that can be tested; thus, the world is full of build servers executing unoptimized tests, exercising unoptimized code.</p><p>If the tests and the code they are exercising are long-running and computationally expensive, lack of optimization will make them run even slower.</p><p>However, virtually nothing ever gets debugged on a build server, so there is virtually never a need to have it running unoptimized code.</p></li><li><p>It slows down the software on production.</p><p>When a library is published as a package, the configuration that gets packaged is, by common practice, the 'Release' configuration. This configuration executes preconditions, since it may be referenced by a project under development; however, at some point, that project together with the library are released to production, where the library is still executing preconditions.</p><p>This amounts to nothing but a waste of clock cycles, because:</p><ul><li><p>By the time the software using the library gets shipped to production, it has been tested and can be reasonably assumed to be invoking the library only in valid ways.</p></li><li><p>Even if the software did happen to make invalid use of the library on production, it makes very little difference whether the resulting catastrophic failure would be signaled by a precondition failure or by some index out of range exception further down.</p></li></ul></li><li><p>Many preconditions are omitted in the name of performance.</p><p>Library programmers often refrain from asserting certain preconditions, if they suspect them to be even slightly expensive, in light of the fact that preconditions in a library will always be executing, even on production.</p><p>An extreme example to illustrate this scenario is the binary search function, which should, in principle, be enforcing the precondition that the array to search must be sorted. Yes, this means guarding a <strong>O(log<sub>2</sub>(N))</strong> operation with a <strong>O(N)</strong> operation. This is fine during development, because we test with small amounts of data anyway, but is a terrible thing to be doing on production; thus, there is virtually no library in existence with such a precondition in it, despite the fact that it is necessary.</p></li></ul><h3 id=the-solution>The Solution</h3><p>From the description of the problem it becomes evident that preconditions must be controlled separately from assertions, and both of those must be controlled separately from optimizations. Therefore, four different build configurations can be thought of:</p><ol><li><p>A 'Debug' configuration</p><p>Everyone is more or less already familiar with this. It is meant for use by a developer when testing and debugging software on their local computer. Assertions are enabled, preconditions are enabled, and optimizations are disabled, because they interfere with debugging.</p></li><li><p>An 'Optimized' configuration</p><p>This is the same as Debug except that optimizations are enabled. It is meant to run on the build server, where we do not usually debug, so there is no reason to be running unoptimized software. Note that this configuration is only useful for projects that suffer from long-running, computationally expensive tests; projects that do testing right, with very short and lightweight tests, are likely to see a performance degradation from this configuration, due to the additional JITting overhead <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p></li><li><p>A 'Develop' configuration</p><p>This configuration is only applicable to libraries, not to applications. It is identical to what was previously understood as the Release configuration, where optimizations are enabled, assertions are disabled, and preconditions are enabled; however, it is only meant to be used when developing software that makes use of the library, not for shipping to production, because we do not want to be executing preconditions on production.</p></li><li><p>A 'Release' configuration</p><p>This is similar to the Develop configuration, except that preconditions are also disabled. It is the configuration which is meant for shipping to production. Note that the benefit of using this configuration is not just maximum performance on production; it is also the freedom to add as many preconditions as necessary to the library, knowing that they cost nothing on production.</p></li></ol><p>Here is the feature matrix:</p><div class=table-wrapper><table><thead><tr><th style=text-align:right></th><th style=text-align:center>Debug</th><th style=text-align:center>Optimized</th><th style=text-align:center>Develop</th><th style=text-align:center>Release</th></tr></thead><tbody><tr><td style=text-align:right>Optimizations disabled</td><td style=text-align:center>✅</td><td style=text-align:center>⬜</td><td style=text-align:center>⬜</td><td style=text-align:center>⬜</td></tr><tr><td style=text-align:right>Assertions enabled</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>⬜</td><td style=text-align:center>⬜</td></tr><tr><td style=text-align:right>Overflow checking</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>⬜</td><td style=text-align:center>⬜</td></tr><tr><td style=text-align:right>Preconditions enabled</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>⬜</td></tr><tr><td style=text-align:right>Code analysis</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>⬜</td><td style=text-align:center>⬜</td></tr></tbody></table></div><p>Here is an excerpt from a <code>.csproj</code> file implementing the above matrix, assuming that we have defined our own set of assertion functions, dependent upon an <code>ASSERTIONS</code> define-constant, and our own set of precondition functions, dependent upon a <code>PRECONDITIONS</code> define-constant.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;Choose&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;When</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Debug&#39;&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Optimize&gt;</span>False<span class=nt>&lt;/Optimize&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DefineConstants&gt;</span>$(DefineConstants);PRECONDITIONS;ASSERTIONS<span class=nt>&lt;/DefineConstants&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;CheckForOverflowUnderflow&gt;</span>True<span class=nt>&lt;/CheckForOverflowUnderflow&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;EnableNETAnalyzers&gt;</span>True<span class=nt>&lt;/EnableNETAnalyzers&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DebugType&gt;</span>Full<span class=nt>&lt;/DebugType&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/When&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;When</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Optimized&#39;&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Optimize&gt;</span>True<span class=nt>&lt;/Optimize&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DefineConstants&gt;</span>$(DefineConstants);PRECONDITIONS;ASSERTIONS<span class=nt>&lt;/DefineConstants&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;CheckForOverflowUnderflow&gt;</span>True<span class=nt>&lt;/CheckForOverflowUnderflow&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;EnableNETAnalyzers&gt;</span>True<span class=nt>&lt;/EnableNETAnalyzers&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DebugType&gt;</span>Full<span class=nt>&lt;/DebugType&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;OutputPath&gt;</span>bin\$(Configuration)\<span class=nt>&lt;/OutputPath&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/When&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;When</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Develop&#39;&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Optimize&gt;</span>True<span class=nt>&lt;/Optimize&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DefineConstants&gt;</span>$(DefineConstants);PRECONDITIONS<span class=nt>&lt;/DefineConstants&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;CheckForOverflowUnderflow&gt;</span>False<span class=nt>&lt;/CheckForOverflowUnderflow&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;EnableNETAnalyzers&gt;</span>False<span class=nt>&lt;/EnableNETAnalyzers&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DebugType&gt;</span>Portable<span class=nt>&lt;/DebugType&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;OutputPath&gt;</span>bin\$(Configuration)\<span class=nt>&lt;/OutputPath&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/When&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;When</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Release&#39;&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Optimize&gt;</span>True<span class=nt>&lt;/Optimize&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DefineConstants&gt;</span>$(DefineConstants)<span class=nt>&lt;/DefineConstants&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;CheckForOverflowUnderflow&gt;</span>False<span class=nt>&lt;/CheckForOverflowUnderflow&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;EnableNETAnalyzers&gt;</span>False<span class=nt>&lt;/EnableNETAnalyzers&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DebugType&gt;</span>Portable<span class=nt>&lt;/DebugType&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Deterministic&gt;</span>True<span class=nt>&lt;/Deterministic&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;DeterministicSourcePaths&gt;</span>True<span class=nt>&lt;/DeterministicSourcePaths&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/When&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;Otherwise&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/Otherwise&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/Choose&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>If we follow this build configuration scheme, then each time we publish a library we must generate two packages: the 'Develop' package, and the 'Release' package.</p><ul><li>The 'Develop' package is to be referenced by software under development.</li><li>The 'Release' package is to be referenced by software that is being shipped to production.</li></ul><p>The generation of two different packages for a single library can be accomplished by building twice, once for each configuration, and constructing the assembly name as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;AssemblyName&gt;</span>$(MSBuildProjectName)-$(Configuration)<span class=nt>&lt;/AssemblyName&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>This way, instead of a single package called <code>MyPackage</code> we create two packages: <code>MyPackage-Develop</code> and <code>MyPackage-Release</code>.</p><p>There may be a better way to build a library, so that only one package gets generated, containing both the develop and release builds, and the right binaries somehow end up in the right output directory; however, I have not been able to figure that out yet. If you know how to do it, please let me know.</p><p>For any build configuration of a certain module, (either an application or a library,) the build configuration of the libraries it uses can be determined using the following table:</p><div class=table-wrapper><table><thead><tr><th style=text-align:center>Build configuration of<br>module using library</th><th style=text-align:center>Build configuration of<br>library</th></tr></thead><tbody><tr><td style=text-align:center>'Debug'</td><td style=text-align:center>'Develop'</td></tr><tr><td style=text-align:center>'Optimized'</td><td style=text-align:center>'Develop'</td></tr><tr><td style=text-align:center>'Develop'</td><td style=text-align:center>'Develop'</td></tr><tr><td style=text-align:center>'Release'</td><td style=text-align:center>'Release'</td></tr></tbody></table></div><p>Note that the 'Develop' configuration of a module could, in theory, make use of the better-performing 'Release' configuration of a library, instead of the 'Develop' configuration; however, that can only work if the module does not expose the library, or if there is no other module in the solution that uses the 'Develop' configuration of the library. Otherwise, there are going to be build errors saying that a certain type exists in both the develop and release configuration of a certain library.</p><p>Here is an excerpt of a .csproj file implementing the above table:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;PropertyGroup&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;PackagesConfiguration</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Debug&#39;&#34;</span>    <span class=nt>&gt;</span>Develop<span class=nt>&lt;/PackagesConfiguration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;PackagesConfiguration</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Optimized&#39;&#34;</span><span class=nt>&gt;</span>Develop<span class=nt>&lt;/PackagesConfiguration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;PackagesConfiguration</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Develop&#39;&#34;</span>  <span class=nt>&gt;</span>Develop<span class=nt>&lt;/PackagesConfiguration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;PackagesConfiguration</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39;==&#39;Release&#39;&#34;</span>  <span class=nt>&gt;</span>Release<span class=nt>&lt;/PackagesConfiguration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Then, packages can be referenced as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;PackageReference</span> <span class=na>Include=</span><span class=s>&#34;MyPackage-$(PackagesConfiguration)&#34;</span> <span class=na>Version=</span><span class=s>&#34;...&#34;</span> <span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=conclusions>Conclusions</h3><ul><li>An 'Optimized' build configuration has been proposed, for cutting in half the time it takes to run slow, computationally expensive tests on build servers. (Not needed by projects with small, fast tests.)</li><li>A 'Develop' build configuration for libraries has been proposed, intended for use during development of software using the libraries, but not for shipping to production. It has preconditions enabled, in order to catch bugs in the software using the libraries.</li><li>A 'Release' build configuration for libraries has been proposed, intended for shipping to production. It improves performance by not executing preconditions.</li><li>Under the proposed schema, preconditions in libraries do not incur a performance penalty on production anymore, so programmers can apply them more liberally, leading to more robust software.</li><li>Under the proposed schema, when a library is published, two packages should be generated: the 'Develop' package, for developing software that uses the library, and the 'Release' package, for shipping to production.</li></ul><hr><p>Cover image generated by ChatGPT, and then retouched by michael.gr. The prompt used was: "Please give me an image conveying the concept of highly complex and highly technical software development. Make it in landscape format, of photographic quality, with warm colors" and then "Please make the programmer look more senior".</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The creators of Java made it so that the generation of code within an <code>if()</code> statement controlled by a compile-time constant is suppressed if that constant evaluates to <code>false</code>, but they intentionally deprived developers from the ability to specify the value of a compile-time constant via external means, such as the command-line of the compiler. They defended this choice by saying that there is inherent merit in being able to guarantee that in Java every compilation unit has one and only one set of semantics. The usefulness of this merit is debatable. It can be argued that this is simply Java treating developers the same way that Apple has been treating users: as idiots.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>In C# most optimizations are performed by the Just-In-Time compiler (JITter), and people say that the optimizations performed by the language compiler do not make much of a difference. However, my experiments have shown otherwise: computation-intensive code tends to run twice as fast when optimizations are enabled than when not, and this difference can be observed on a build server, so it is unaffected by any optimization choices that the JITter might make due to a debugger being attached or not. I suspect that this is happening because the language compiler saves the "optimize" flag in the binary, and the JITter subsequently observes this flag.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/software-engineering/>Software Engineering</a>
<a href=/tags/dotnet/>Dotnet</a>
<a href=/tags/csharp/>C#</a>
<a href=/tags/msbuild/>Immutability</a>
<a href=/tags/papers/>Papers</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on 2025-10-21 Tue 19:00:42 CEST</span></section></footer></article><script>var idcomments_post_id,idcomments_post_url,idcomments_acct="131c02e0ef20d1a4606aa4e3490711ba"</script><span id=IDCommentsPostTitle style=display:none></span>
<script type=text/javascript src=https://www.intensedebate.com/js/genericCommentWrapperV2.js></script><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/2025-06-immutability-assessment/><div class=article-details><h2 class=article-title>Immutability Assessment</h2></div></a></article><article><a href=/post/2024-10-testana/><div class=article-details><h2 class=article-title>Testana: A better way of running tests</h2></div></a></article><article><a href=/post/2023-02-09-vs-debug-logger/><div class=article-details><h2 class=article-title>New GitHub project: VsDebugLogger</h2></div></a></article><article><a href=/post/2022-12-intertwine/><div class=article-details><h2 class=article-title>Intertwine</h2></div></a></article><article><a href=/post/2011-10-16-intertwine-normalizing-interface/><div class=article-details><h2 class=article-title>Intertwine: Normalizing Interface Invocations</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy; 2001 - 2026 Michael Belivanakis (a.k.a. Mike Nakis)</section><section class=powerby>Made using <b><a href=https://obsidian.md target=_blank>Obsidian</a></b> and <b><a href=https://gohugo.io/ target=_blank>Hugo</a></b><br>Theme based on <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank data-version=%s>hugo-theme-stack</a></b> by <a href=https://jimmycai.com target=_blank>Jimmy Cai</a><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>